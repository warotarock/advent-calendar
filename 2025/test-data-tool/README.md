# test-data-tool
テストデータ用のSQLの作成をサポートするツール

# 仕様

# 構成

- プロジェクト一覧のJSONをIndexedDBから読み込む
- プロジェクト設定のJSONをIndexedDBから読み込む
- プロジェクト設定のJSONはプロジェクトの設定のページからインポート/エクスポート可能
- 左右2ペイン構成の画面とし、「テーブル設計」パネルのペインを左、「テストデータ設計」パネルのペインを右に表示する

# データ構造

## プロジェクト設定

```
ProjectSetting
  tableDesigns: TableDesign[]
  testDataDesigns: TestDataDesign[]
```

## テーブル設計

```
テーブル設計
TableDesign
  name: string
  columnDesigns: ColumnDesign[]

列設計
ColumnDesign
  name: string
  type: string
  isNullable: boolean
  maxLength?: number
  useThousandsSeparator?: boolean
```

## テストデータ設計

```
テストデータ設計
TestDataDesign
  name: string
  note?: string
  testDataTrees: TestDataTree[]

テストデータツリー
TestDataTree
  id: string
  name: string
  note?: string
  isVisible: boolean
  isExpanded: boolean
  rootNode: TestDataNode[]

テストデータノード
TestDataNode
  id: string
  name: string
  note?: string
  isVisible: boolean
  isSelected: boolean
  isExpanded: boolean
  tableName: string
  joinColumns: TestDataNodeJoinColumn[]
  columnSettings: TestDataNodeColumnSetting[]
  records: TestDataRecord[]
  children: TestDataNode[]

テストデータJoin列
TestDataNodeJoinColumn
  id: string
  from: string
  to: string

テストデータノード列設定
TestDataNodeColumnSetting
  id: string
  columnName: string
  isVisible: boolean
  defaultValue?: string

テストデータレコード
TestDataRecord
  id: string
  isVisible: boolean
  isSelected: boolean
  note?: string
  fieldValues: Record<string, TestDataRecordFieldValue>

レコードフィールド値
TestDataRecordFieldValue
  id: string
  value: string
  isNull?: boolean
  note?: string
```

# UI部品

## ツールバー

ボタン要素を並べたUI。
基本的に左寄せでボタンを表示し、一部のボタンは右寄せで表示する。

## 一覧

テーブル設計一覧など、縦方向のリストを表示するためのUI。
自動で縦スクロールバーを表示してスクロール可能とする。

## データ入力グリッド

データ入力用のグリッド形式のUI。
テーブル要素でレイアウトする。

Excelに似た操作性で、キーボード入力、マウス入力に対応する。
マウスクリックでグリッドの行およびセルを選択する。
方向キーでセルの選択状態を現在選択中のセルから隣接セルに移動する。

F2キーまたはキーボード入力でセルの入力状態になる。
入力状態では、選択中のセルの上に入力用のinput要素を表示する。
EnterキーまたはTabキーで入力内容を確定する。Tabキーの場合、すぐ右のセルを選択する。

# ヘッダーパネル

画面上部にヘッダーを表示する。

## ハンバーガーメニュー

ヘッダー左上にハンバーガーメニューを表示する。
ハンバーガーメニューの内容は以下の通り。

- プロジェクトを開く
- プロジェクトを保存

## 「プロジェクトを開く」ダイアログ

「プロジェクトを開く」をクリックすると、プロジェクトを選択するモーダルダイアログが開く。
ダイアログにはプロジェクト設定の一覧を表示する。
ダイアログ右上に、「追加」ボタン、「削除」ボタンを表示する。

## プロジェクト名テキストボックス

プロジェクトの名前を入力する適すボックスを表示する。
テキストボックスの内容が変更されたら、テキストボックスの右に保存ボタンを表示する。
保存ボタン押下で、プロジェクト設定のデータに反映する。

# テーブル設計パネル

## テーブル一覧

テーブル設計パネルの上半分に、「テーブル一覧」パネルを表示する。
プロジェクトに存在する全てのテーブルを一覧で表示する。
文字コード順で表示する。

キーボード操作およびマウス操作で項目を選択する。

一覧の上部にツールバーを表示する。
- 「追加」  
テーブルを追加する。
- 「名前の変更」  
選択中のテーブルの名前を変更する。
- 「複製」  
選択中のテーブルを複製する。
- 「削除」  
右寄せで配置。

## カラム設計

### 概要

テーブル設計パネルの下半分に、「カラム設計」パネルを表示する。
テーブル一覧で選択中のテーブルの全ての列をデータ入力グリッドで表示する。

### ツールバー

一覧の上部にツールバーを表示する。

- 「追加」  
カラムを追加する。
- 「複製」  
選択中のカラムを複製し、選択中のカラムの下の位置に挿入する。
- 「↑」  
選択中のカラムを一つ上の位置に移動する。
- 「↓」  
選択中のカラムを一つ下の位置に移動する。
- 「保存」  
テーブルのカラム設計のデータを確定する機能とする予定。
現在は仮にプロジェクト全体の保存を行っている。
- 「削除」  
右寄せで配置。

### グリッド

グリッドには、以下の列を表示する。

- 列名（テキスト入力）
- 型（セレクトボックス入力：選択肢…int、decimal、string、GUID、Date、DateTime）

# テストデータ設計パネル

## テストデータ設計一覧

### 概要

テストデータ設計パネルの上半分に、「テストデータ設計一覧」パネルを表示する。
プロジェクトに存在する全てのテストデータ設計を一覧で表示する。
文字コード順で表示する。

キーボード操作およびマウス操作で項目を選択する。

### ツールバー

一覧の上部にツールバーを表示する。

- 「追加」
- 「削除」
- 「名前の変更」
- 「複製」

## テストデータ設計エディタ

### 概要

テーブル設計パネルの右半分に、「テストデータ設計エディタ」パネルを表示する。
テストデータ設計一覧で選択中のテストデータ設計のデータを表示する。

エディタに表示するモデルデータそのままの親子関係あるいは階層関係を持つ。

エディタ中では、ツリー、ノード、レコード、セル（＝フィールド値）といった要素のいずれか一つに対してフォーカスしている状態を持つ。
フォーカスしている要素は、フォーカス中であることが分かるよう色を変えて表示する。

ツリー、ノード、レコードはその要素の配下にフォーカスがある場合、色を変えて表示する。

### ツールバー

エディタ上部にツールバーを表示する。

- 「追加」  
テストデータの追加
- 「↑」  
選択中のツリー/ノードを一つ上の位置に移動する。テストデータツリーの選択チェックボックスがチェックONの場合、ノードではなくテストデータツリーを移動する。
- 「↓」  
ツリー/ノードに対して「↑」と同様に下に移動する操作を行う。
- 「ノード追加」  
フォーカス中のツリー/ノードに子ノードを追加する。
- 「レコード追加」  
選択中の
- 「削除」  
フォーカス/選択中のテストデータの削除。右寄せで配置。確認メッセージ表示。

### ノード設定（テストデータテーブル設定）

現在フォーカスのあるノードに表示するテーブルとテーブル列を設定する。

セレクトボックスからプロジェクトに作成済みのテーブルを選択する。
選択すると、現在フォーカスのあるノードに対し、テーブル名をセットする。
既にノードにテーブル名がセットされていた場合、上書き確認のメッセージを表示する。
テーブル名が変更された場合、ノードのテストデータノード列設定をクリアする。

セレクトボックスの下に、ツールバーを表示する。

- 「追加」  
現在フォーカスのある列設定の下に列設定を追加する
- 「削除」
現在フォーカスのある列設定を削除する

ツールバーの下に、テストデータノード列設定のデータ入力グリッドを表示する。
グリッドの列は以下の通り。

- 列名  
セレクトボックスでテーブルの列を選択する。
- 表示  
チェックボックスのセル。input要素は使用せず、セルのクリックでON/OFFする。エディタに列を表示する場合はチェックON。
- 初期値  
テストデータ作成時、フィールド値が空の場合に自動で使用する値。

### エディタ

テストデータ設計一覧で選択中のテストデータ設計を編集するエディタ。
Excelに似た操作性で、キーボード入力、マウス入力に対応する。

全てのテストデータツリー/ノードを縦方向に並べて表示する。

テストデータツリー以下にノードの入れ子階層を表示する。ノードは階層の深さに応じた幅のインデント（左マージン）を空けて表示する。

エディタ左側に行選択用のチェックボックスを表示する。ツリーやノードをまとめて移動/コピー/削除等をする際に使用する。

エディタ左側に折り畳みスイッチを表示する。ツリー/ノード毎に表示する。表示ON状態「V」で子ノードを表示、表示OFF状態「>」で子ノードを非表示にする。

#### テストデータツリー

テストデータツリーは左から順に以下の内容が表示される。

1行目

- 選択チェックボックス
- 折り畳みスイッチ「V/>」
- 名前
- 備考（note）

2行目：ツリーにノードが1件もない場合
- 「ノードなし」

2行目以降：ツリーにノードが1件以上ある場合
件数分だけノードが表示される。

#### テストデータノード

テストデータノードは左から順に以下の内容が表示される。

1行目

- 選択チェックボックス
- 折り畳みスイッチ「V/>」
- インデント
- 名前（名前が空文字列の場合、「テーブル未選択」と表示）
- 備考

2行目以降：ノードにレコードが1件以上ある場合、レコードをグリッド表示

2行目：ノードにレコードが1件もない場合
- インデント
- 「レコードなし」

ノードがアクティブである場合、「ノードのプロパティ」パネルにノードの情報を表示する。

#### テストデータレコード

テストデータレコードは左から順に以下の内容が表示される。

- 選択チェックボックス
- インデント
- フィールド値（テストデータ列設定分だけ表示）

#### レコードフィールド値セル

グリッドのヘッダにテストデータノード列設定の列名を表示する。
セルの表示/入力フォーマットはテストデータノード列設定に対応するテーブル設計の列設計の種別に応じた形式で表示/入力する。

表示/入力フォーマット：

- 共通  
セルの値は文字列で保存し、最大長の指定などに違反があってもそのまま値を保存する。Ctrl+0キー入力でNULLを入力する。数値、日付はセルを空にするとNULL値扱いとする。文字列はセルに「<< NULL >>」と入力するとNULL扱いとする。
- 数値  
千位区切りがONの場合、3桁毎のカンマ区切りで表示/入力する。入力確定時にカンマを削除して数値を取得する。最大長が指定されている場合、カンマ抜きの桁数で判定し、最大長を超える場合はセルをエラー色表示する。
- 文字列  
文字列を表示/入力する。最大長が指定されている場合、入力の文字列が最大長を超える場合はセルをエラー色表示する。
- 日付  
文字列と同様の入力方法で入力する。入力文字列が日付に変換できない場合、セルをエラー色表示する。
